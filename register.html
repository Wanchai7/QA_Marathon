<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนวิ่งมาราธอน 2025</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        /* (ใช้ Style เดิมจากไฟล์ก่อนหน้าได้เลยครับ เพื่อความสั้นผมขอละไว้) */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; }
        .hero-banner {
            background-image: url('https://images.unsplash.com/photo-1452626038306-3a4a47c60313?q=80&w=2074&auto=format&fit=crop');
            background-size: cover; background-position: center 30%; height: 350px;
            position: relative; display: flex; align-items: center; justify-content: center;
        }
        .hero-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); }
        .banner-text { position: relative; z-index: 1; text-align: center; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .banner-text h1 { font-weight: 800; font-size: 3rem; margin-bottom: 10px; }
        .form-container {
            max-width: 850px; margin: -80px auto 50px; background: white; padding: 40px;
            border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); position: relative; z-index: 10;
        }
        .section-header { border-left: 5px solid #0d6efd; padding-left: 15px; margin-top: 35px; margin-bottom: 25px; color: #0d6efd; font-weight: 600; font-size: 1.3rem; display: flex; align-items: center; }
        .total-box {
            background: linear-gradient(135deg, #e7f1ff 0%, #d4e4ff 100%); color: #0d6efd;
            padding: 25px; border-radius: 15px; text-align: right; font-size: 1.8rem; font-weight: bold;
        }
    </style>
</head>
<body>

<div class="hero-banner">
    <div class="hero-overlay"></div>
    <div class="banner-text">
        <h1>MARATHON 2025</h1>
        <p><i class="bi bi-calendar-event"></i> 15 ธันวาคม 2568 | <i class="bi bi-geo-alt-fill"></i> สวนสาธารณะใจกลางเมือง</p>
    </div>
</div>

<div class="container">
    <div class="form-container">
        <form id="regisForm" action="save_registration.php" method="POST">
            
            <h4 class="section-header"><i class="bi bi-person-circle"></i> 1. ข้อมูลนักวิ่ง</h4>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">ชื่อจริง <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="ชื่อจริง" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">นามสกุล <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="นามสกุล" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">เลขบัตรประชาชน <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" name="เลขบัตรประชาชน" maxlength="13" required>
                </div>
                
                <div class="col-md-6">
                    <label class="form-label">วันเกิด <span class="text-danger">*</span></label>
                    <input type="date" class="form-control" id="birthDate" name="วันเกิด" onchange="checkAge()" required>
                    <small id="ageDisplay" class="text-muted"></small> </div>

                <div class="col-md-6">
                    <label class="form-label">เพศ <span class="text-danger">*</span></label>
                    <select class="form-select" name="เพศ" required>
                        <option value="ชาย">ชาย</option>
                        <option value="หญิง">หญิง</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">เบอร์โทรศัพท์</label>
                    <input type="tel" class="form-control" name="เบอร์โทรศัพท์">
                </div>
                <div class="col-md-12">
                    <label class="form-label text-danger fw-bold"><i class="bi bi-heart-pulse-fill"></i> โรคประจำตัว</label>
                    <input type="text" class="form-control border-danger" name="โรคประจำตัว" placeholder="ระบุโรคประจำตัว (ถ้าไม่มีพิมพ์ -)" required>
                </div>
                <div class="col-md-12">
                    <label class="form-label">อีเมล <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" name="อีเมล" required>
                </div>
            </div>

            <h4 class="section-header"><i class="bi bi-trophy-fill"></i> 2. รายละเอียดการสมัคร</h4>
            <div class="row g-3">
                <div class="col-md-12">
                    <label class="form-label text-primary">เลือกประเภทการแข่งขัน <span class="text-danger">*</span></label>
                    <select class="form-select form-select-lg mb-3 border-primary" id="raceCategory" name="รหัสประเภท" onchange="calculatePrice()" required>
                        <option value="" data-price="0" selected disabled>-- กรุณาเลือกระยะทาง --</option>
                        <option value="1" data-price="1200">Full Marathon (42 km) - 1,200 บ.</option>
                        <option value="2" data-price="900">Half Marathon (21 km) - 900 บ.</option>
                        <option value="3" data-price="600">Mini Marathon (10.5 km) - 600 บ.</option>
                        <option value="4" data-price="400">Fun Run (5 km) - 400 บ.</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label">ประเภทผู้สมัคร</label>
                    <select class="form-select" id="runnerType" name="ประเภทนักวิ่ง" onchange="calculatePrice()">
                        <option value="บุคคลทั่วไป" data-discount="0">บุคคลทั่วไป</option>
                        
                        <option value="ผู้สูงอายุ" data-discount="200" id="optionSenior">ผู้สูงอายุ 60+ (ลด 200 บ.)</option>
                        
                        <option value="ผู้พิการ" data-discount="500">ผู้พิการ (ลด 500 บ.)</option>
                    </select>
                    <small id="ageWarning" class="text-danger" style="display:none;">* อายุไม่ถึง 60 ปี ไม่สามารถเลือกเรทผู้สูงอายุได้</small>
                </div>
                <div class="col-md-6">
                    <label class="form-label">ไซส์เสื้อ</label>
                    <select class="form-select" name="ไซส์เสื้อ">
                        <option value="M">M</option>
                        <option value="L">L</option>
                        <option value="XL">XL</option>
                    </select>
                </div>
            </div>

            <h4 class="section-header"><i class="bi bi-truck"></i> 3. การจัดส่ง</h4>
            <div class="row g-3">
                <div class="col-md-12">
                    <select class="form-select" id="shippingOption" name="รหัสขนส่ง" onchange="calculatePrice()" required>
                        <option value="1" data-cost="0">รับเองหน้างาน (ฟรี)</option>
                        <option value="2" data-cost="60">EMS (+60 บ.)</option>
                    </select>
                </div>
            </div>

            <hr class="my-5">

            <div class="total-box">
                ยอดสุทธิ: <span id="totalDisplay">0</span> บาท
                <input type="hidden" id="totalAmount" name="ยอดรวม" value="0">
            </div>

            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-primary btn-lg shadow-sm">ยืนยันการสมัคร</button>
            </div>
        </form>
    </div>
</div>

<script>
    function checkAge() {
        const birthDateInput = document.getElementById('birthDate').value;
        const seniorOption = document.getElementById('optionSenior');
        const runnerTypeSelect = document.getElementById('runnerType');
        const warningText = document.getElementById('ageWarning');
        const ageDisplay = document.getElementById('ageDisplay');

        if (birthDateInput) {
            // สูตรคำนวณอายุ
            const today = new Date();
            const birthDate = new Date(birthDateInput);
            let age = today.getFullYear() - birthDate.getFullYear();
            const monthDiff = today.getMonth() - birthDate.getMonth();
            
            // ปรับละเอียด (ถ้ายังไม่ถึงเดือนเกิด ให้ลบอายุไป 1 ปี)
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }

            // แสดงอายุข้างช่องวันเกิด
            ageDisplay.innerText = "อายุ: " + age + " ปี";

            // ตรวจสอบเงื่อนไข
            if (age < 60) {
                // ถ้าอายุน้อยกว่า 60
                seniorOption.disabled = true; // ล็อกปุ่มเลือก
                
                // ถ้าเผลอเลือกไว้อยู่แล้ว ให้ดีดกลับเป็น "บุคคลทั่วไป"
                if (runnerTypeSelect.value === 'ผู้สูงอายุ') {
                    runnerTypeSelect.value = 'บุคคลทั่วไป';
                    calculatePrice(); // คำนวณเงินใหม่ทันที
                    warningText.style.display = 'block'; // โชว์ข้อความเตือน
                    setTimeout(() => warningText.style.display = 'none', 3000); // ซ่อนเตือนใน 3 วิ
                }
            } else {
                // ถ้าอายุ 60+
                seniorOption.disabled = false; // ปลดล็อก
            }
        }
    }

    function calculatePrice() {
        const raceSelect = document.getElementById('raceCategory');
        const basePrice = parseFloat(raceSelect.options[raceSelect.selectedIndex].getAttribute('data-price')) || 0;
        
        const typeSelect = document.getElementById('runnerType');
        const discount = parseFloat(typeSelect.options[typeSelect.selectedIndex].getAttribute('data-discount')) || 0;
        
        const shipSelect = document.getElementById('shippingOption');
        const shippingCost = parseFloat(shipSelect.options[shipSelect.selectedIndex].getAttribute('data-cost')) || 0;
        
        let total = (basePrice - discount) + shippingCost;
        if (total < 0) total = 0;
        
        document.getElementById('totalDisplay').innerText = total.toLocaleString();
        document.getElementById('totalAmount').value = total;
    }
</script>

</body>
</html>